{{/* layouts/partials/sections/gallery.html - Defensive Version */}}
<section class="section" id="cases">
  <div class="container">
    <div class="section-header text-center">
      <h2 class="section-title">قصص نجاح وحالات واقعية</h2>
      <p class="section-subtitle">شاهد الفرق قبل وبعد العلاج</p>
    </div>

    {{/* ✅ التصحيح: استخدام site.RegularPages بدلاً من .Site */}}
    {{/* والتحقق من وجود صفحات قبل التكرار */}}
    
    {{ $cases := where site.RegularPages "Section" "cases" }}
    
    {{ if gt (len $cases) 0 }}
      <div class="gallery-grid">
        {{ range first 6 $cases }}
          <div class="gallery-item">
            <div class="images-wrapper">
              {{/* التحقق من وجود الصور (Defensive Image Logic) */}}
              {{ $after := .Resources.GetMatch "after*" }}
              {{ $before := .Resources.GetMatch "before*" }}
              
              {{ if $after }}
                <img src="{{ $after.RelPermalink }}" alt="After - {{ .Title }}" class="img-after">
              {{ else }}
                <div class="placeholder">After</div>
              {{ end }}
              
              <div class="label after">After</div>
              <div class="label before">Before</div>
            </div>
            
            <div class="case-info">
              <h3><a href="{{ .RelPermalink }}">{{ .Title }}</a></h3>
              <p>{{ .Params.short_description | default "شاهد تفاصيل الحالة..." }}</p>
            </div>
          </div>
        {{ end }}
      </div>
      
      <div class="text-center mt-3">
        <a href="/cases/" class="btn btn-outline">شاهد جميع الحالات</a>
      </div>

    {{ else }}
      {{/* رسالة بديلة في حالة عدم وجود محتوى */}}
      <div class="alert alert-info text-center">
        جاري إضافة الحالات المميزة قريباً...
      </div>
    {{ end }}
  </div>
</section>
